<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>calico on</title><link>https://www.ryken.cloud/tags/calico/</link><description>Recent content in calico on</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 06 May 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://www.ryken.cloud/tags/calico/index.xml" rel="self" type="application/rss+xml"/><item><title>calico 应急方案</title><link>https://www.ryken.cloud/calico-%E5%BA%94%E6%80%A5%E6%96%B9%E6%A1%88/</link><pubDate>Sat, 06 May 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/calico-%E5%BA%94%E6%80%A5%E6%96%B9%E6%A1%88/</guid><description>确认出现问题的具体部分和错误现象 确认问题出现的时间、场景，了解系统的运行环境、版本信息、系统配置等，以便明确问题的范围和分析。 确认错误现象是否具有可重现性，是否存在规律性与周期性，有助于问题进一步排查和分析。 检查 Calico 日志[[日志]] 查看 calico describe 以及日志。[[通过事件、日志排查]] 根据错误提示或警告信息，查找相关的解决方案或错误排除方法。 如果日志中没有明显错误或警告信息，可以将日志级别调整为 DEBUG，查看更为详细的日志信息，进一步分析问题原因。 calico没有明显错误日志记录时，可以查看系统日志，并参考系统资源情况来分析问题原因。[[根据系统日志排查]] 进行网络诊断 [[网络工具诊断]] 使用 ping、traceroute、tcpdump 等网络诊断工具，检查网络连通性和网络通信状态(pod-pod/pod-node/pod-svc/node-svc/node-gateway、pod-gateway)，确认是否存在网络问题，并从 gateway→node→svc→pod 一层一层更细化的定位问题根源。 如果问题根源涉及 pod，可以从 ipam、bgp 路由角度分析 如果涉及 svc，可以从 kube-proxy、iptables 角度分析 如果涉及 node，可以从物理网络、gateway 角度分析 对比不同机器上的性能指标以及网络状况，确定出错的机器是否存在特殊网络问题。 检查 Calico 配置 [[calico配置文件]] 确认 Calico 的配置文件是否正确，是否缺失或错误配置。包括 cni configmap、bgp、bgppeer、felix等相关配置 检查系统资源使用情况 查看系统 CPU、内存、磁盘等资源的使用情况，如果存在资源不足或超载现象，可以考虑优化或扩容。 确认 Calico 的网络带宽使用情况，分析网络流量的分布和情况，确认是否出现了网络流量瓶颈。 逐一排查可能的原因 如果是网络通信问题，可以检查网络拓扑，路由器、交换机、防火墙等设备的配置，确认是否存在配置错误或故障。 如果是性能瓶颈问题，可以进行性能测试和优化，如使用性能工具、调整配置参数等。 如果是系统崩溃问题，可以通过故障日志、内存转储文件等进行分析定位。 进行测试环境部署和测试 如果出现问题的环境比较复杂，可以考虑在测试环境中进行部署和测试，以排除环境配置和部署工具问题。 更新和升级 Calico 版本 如果发现 Calico 的问题存在于旧版本中，可以尝试升级到最新版本。 Upgrade Calico on Kubernetes 寻求社区帮助 如果以上方法无法解决问题，可以联系 Calico 的社区成员，提供详细的问题描述和相关信息，以便社区成员进行协助和解决。 可以在社区论坛或邮件列表上留言，或直接向社区成员联系，提供相关问题信息，交流问题解决方案。 Issues · projectcalico/calico Discuss Calico https://calicousers.</description></item><item><title>网络工具诊断</title><link>https://www.ryken.cloud/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7%E8%AF%8A%E6%96%AD/</link><pubDate>Sat, 06 May 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7%E8%AF%8A%E6%96%AD/</guid><description>定位问题 出现问题时先定位是哪一部分发生了问题，dns 解析、kube-proxy、cni、底层网络 [[网络排查]]
需要用到的网络排查工具：
使用工具进行网络诊断 使用 ping 命令检测 icmp 是否可通 使用 nc、curl 检测四层是否可通 使用 nsloopup 检测 dns 是否可用 使用 tcpdump 抓包分析 如果对应 pod 容器中，没有相关的网络工具，可以在宿主机上进入到对应 pod 容器的网络空间操作</description></item><item><title>calico metrics</title><link>https://www.ryken.cloud/calico-metrics/</link><pubDate>Wed, 26 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/calico-metrics/</guid><description> Prometheus statistics (tigera.io)
指标 描述 felix_active_local_endpoints 该主机上活动的 endpoints 数量 felix_active_local_policies 该主机上活跃的策略数 felix_active_local_selectors 该主机上额活跃 selectors 数 felix_calc_graph_output_events calculation graph 产生的事件数 felix_calc_graph_update_time_seconds 为每个 datastore更新 calculation graph 调用 OnUpdate的秒 felix_calc_graph_updates_processed calculation graph 处理的 datestore 更新次数 felix_cluster_num_host_endpoints 集群层面 host endpoints 的总数 felix_cluster_num_hosts 集群中的 Calico hosts 总数 felix_cluster_num_workload_endpoints 集群层负载 endpoints 总数 felix_exec_time_micros fork/exec 子进程花费的时间 felix_int_dataplane_addr_msg_batch_size 批处理的接口地址报文数。 较高的值表示我们正在做更多的批处理以试图跟上 felix_int_dataplane_apply_time_seconds 应用数据面更新花费的时间 felix_int_dataplane_failures 数据面更新失败以及重试次数 felix_int_dataplane_iface_msg_batch_size 批处理的接口状态消息数。 较高的值表示我们正在做更多的批处理以试图跟上 felix_int_dataplane_messages 按照类型分类的消息数 felix_int_dataplane_msg_batch_size 批处理的消息数。 较高的值表示我们正在做更多的批处理以试图跟上 felix_ipset_calls ipset 命令执行数 felix_ipset_errors ipset 命令失败数 felix_ipset_lines_executed ipset 执行操作数 felix_ipsets_calico active Calico IP sets 数量 felix_ipsets_total active IP sets 总数 felix_iptables_chains active iptables chains 数量 felix_iptables_lines_executed iptables 规则执行更新数 felix_iptables_restore_calls iptables-restore 调用次数 felix_iptables_restore_errors iptables-restore 错误数 felix_iptables_rules active iptables 规则数 felix_iptables_save_calls iptables-save 调用次数 felix_iptables_save_errors iptables-save 错误数 felix_resync_state 当前 datastore 状态 felix_resyncs_started felix 开始重新同步datastore的次数 felix_route_table_list_seconds 在同步期间列出所有接口所花费的时间 felix_route_table_per_iface_sync_seconds 同步每个接口所花费的时间 felix_log_errors 错误日志数 felix_logs_dropped 由于输出流被阻塞而丢弃的日志数 使用 prometheus 收集监控：[[监控 - monitor]] 使用可视化查看：[[grafana 可视化]]</description></item><item><title>grafana 可视化</title><link>https://www.ryken.cloud/grafana-%E5%8F%AF%E8%A7%86%E5%8C%96/</link><pubDate>Wed, 26 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/grafana-%E5%8F%AF%E8%A7%86%E5%8C%96/</guid><description>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 kubectl apply -f - &amp;lt;&amp;lt;EOF apiVersion: v1 kind: ConfigMap metadata: name: grafana-config namespace: calico-monitoring data: prometheus.</description></item><item><title>kube-controller-manager</title><link>https://www.ryken.cloud/kube-controller-manager/</link><pubDate>Wed, 26 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/kube-controller-manager/</guid><description>Calico kube-controller-manager 是 Deployment。它包含以下控制器：
policy controller：监视网络策略和 calico 策略，它会把Kubernetes的network policies同步到 datastore 中。 namespace controller：监视命名空间和 calico 配置文件，它会把Kubernetes的namespace label变化同步到 datastore 中。 serviceaccount controller：监视服务帐户和 calico 配置文件，它会把Kubernetes的service account变化同步到 datastore 中。 workloadendpoint controller：监视pod标签的更改并更新Calico工作负载中的endpoints配置，它会把Kubernetes的pod label变化同步到 datastore 中。 node controller：监视删除Kubernetes nodes节点的操作并从Calico中也删除相应的数据。</description></item><item><title>监控 - monitor</title><link>https://www.ryken.cloud/%E7%9B%91%E6%8E%A7-monitor/</link><pubDate>Wed, 26 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/%E7%9B%91%E6%8E%A7-monitor/</guid><description>Monitor Calico component metrics (tigera.io)
Configure Calico to enable the metrics reporting. Create the namespace and service account that Prometheus will need.</description></item><item><title>监控文档</title><link>https://www.ryken.cloud/%E7%9B%91%E6%8E%A7%E6%96%87%E6%A1%A3/</link><pubDate>Wed, 26 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/%E7%9B%91%E6%8E%A7%E6%96%87%E6%A1%A3/</guid><description>calicoctl node 作用： calicoctl node run：运行 calico-node 镜像 calicoctl node status： calico-node 的一些状态信息 calicoctl node diags：为 Calico 节点收集诊断包 calicoctl node checksystem：检测该节点能否运行 calico-node 缺陷： 只能获取本节点的信息</description></item><item><title>calico配置文件</title><link>https://www.ryken.cloud/calico%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</link><pubDate>Thu, 20 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/calico%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</guid><description>cni 配置文件 1 kubectl get cm -n kube-system calico-config -o yaml 在安装 calico 时，configmap 中的特定参数会替换为 calico 定义的值，同时该 configmap 也会在 calico-daemonset 的 init 容器初始化时，被拷贝到 /etc/cni/net.</description></item><item><title>calico manifests 安装</title><link>https://www.ryken.cloud/calico-manifests-%E5%AE%89%E8%A3%85/</link><pubDate>Mon, 10 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/calico-manifests-%E5%AE%89%E8%A3%85/</guid><description> upgrade-ipam 用于升级 Calico CNI 插件的 IPAM 管理模块，以支持更高效和灵活的 IP 地址池的管理。 install-cni 安装 calico-cni 到指定目录 flexvol-driver 容器存储接口（CSI）驱动程序 在每个pod中运行的Felix和Dikastes容器之间启用安全连接。它挂载了一个共享卷，Felix将Unix域套接字插入其中 Dikastes是一个容器，它与Calico的Felix组件一起运行，用于在每个pod中实现应用层策略。它通过与Felix共享的Unix域套接字与Felix进行通信，以便在Envoy代理中执行Calico安全策略 https://www.tigera.io/blog/how-to-build-a-service-mesh-with-istio-and-calico/ calico-node</description></item><item><title>felix env</title><link>https://www.ryken.cloud/felix-env/</link><pubDate>Mon, 10 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/felix-env/</guid><description>日志：
FELIX_EARLYLOGSEVERITYSCREEN FELIX_LOGSEVERITYSCREEN go 垃圾回收
GOGC BPF 模式
KUBERNETES_SERVICE_HOST KUBERNETES_SERVICE_PORT 循环加载配置 - 直到 data store ready</description></item><item><title>启动 startup</title><link>https://www.ryken.cloud/%E5%90%AF%E5%8A%A8-startup/</link><pubDate>Mon, 10 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.ryken.cloud/%E5%90%AF%E5%8A%A8-startup/</guid><description>startup 启动流程：
检测 ip 地址和 bgp 使用的网络 使用环境中提供的或自动检测到的 IP/AS 信息配置节点资源 创建默认的 ippool</description></item></channel></rss>