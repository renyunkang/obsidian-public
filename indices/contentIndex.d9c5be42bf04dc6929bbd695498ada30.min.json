{"/":{"title":"AboutTheGarden","content":"\nhello👋，我是 ryken，这是我专用于分享的文档小后院，我的知识小花园在[这里](https://www.ryken.cloud/)，有兴趣的可以瞅一瞅。","lastmodified":"2023-05-25T02:18:50.643442527Z","tags":null},"/%E6%9E%B6%E6%9E%84%E8%B0%83%E6%95%B4":{"title":"架构调整","content":"\n## 背景\n现在 openelb 控制面和数据面在一起还没有拆分，为满足建行的需求，需要将 openelb 拆分为 openelb-manager(deploy) 和 openelb-speaker(ds)，以及包括之后的 openelb-server(ui http server)。拆分过程需要考虑细化组件功能以及各个组件的通信，同时调研 layer2 使用 Leaderelector 还是 memberlist 实现更好的故障转移，以及各个协议speaker是否启用的配置、流程。\n\n功能划分如下：\n\n| 组件               | 功能                             | 其他说明 |\n| ------------------ | -------------------------------- | -------- |\n| openelb-controller | ipam                             | 容器网络         |\n| openelb-speaker    | 路由宣告                         | 主机网络 |\n| openelb-apiserver  | console server 后端              |  容器网络        |\n| openelb-console    | ui 显示                          | 容器网络         |\n| openelb-agent      | 用于获取主机的一些信息给 apiserver |   主机网络       |\n| kse-openelb-plugin | -                                | -        |\n\n### openelb-controller 功能点：\n#### 当前版本需要支持的功能(基本功能)：\n- openelb-controller deploy 支持多副本(主备模式) - leader 选举\n- ipam\n\t- 处理 eip 并为 svc 分配 ip，记录 ip-svc 关系\n\t- 支持默认 eip\n\n#### enhance 功能：\n- svc 指定注解的数量 - 去除重复意义的 openelb 注解，但同时需要注意兼容性\n- webhook 的完善\n\t- 验证 eip (采用 webhookbuilder)\n\t- 对于默认 eip 支持，webhook 修改创建的 service(采用 manager.webhookServer)\n\n\u003e ps: 默认 eip 支持的技术实现为：使用 webhook 拦截 service 的创建事件，并将相应的 openelb 的注解添加到 service 的annotation 列表中，由未指定 eip + protocol 变为指定 eip + protocol 分配。\n\n#### feature 开发：\n1. eip 绑定 namespace - *(删除默认 eip 的支持)*\nipam 分配原理发生变化，由之前的指定 openelb + eip + protocol 的手动指定分配方式变更为以下两种：\n- 自动分配:\n\t- 根据匹配的 namespace 按照特定的算法(轮询、顺序即IP占满后选下一个)来分配，不在意选定 eip 的协议 - **待定**\n\t- 指定 protocol 分配的自动分配\n- 手动指定分配：\n\t- 手动指定 eip 分配\n\t- 手动指定 ip 分配\n\n2. 双栈的支持\n3. loadBalancerClass 字段支持 - 判断是否指定为 openelb\n4. allocateLoadBalancerNodePorts -  调研是否支持\n\n#### 待定：\n- 未开启某一个协议的 speaker，无法创建该协议的 eip\n\n#### 其余问题：\n- loadBalancerIP - Kubernetes v1.24 中被弃用，保留现有的逻辑\n- cni 兼容 - 暂时对 controller 没有影响\n- openelb 在启动时处理所有的 svc\n\n### openelb-speaker 功能点：\n#### 当前版本需要支持的功能(基本功能)：\n1. layer2 speaker：\n- 支持故障转移、自感知节点加入、退出\n- 将 svcip 分布到不同的节点、发布 GARP、回应 arp 请求\n\n2. bgp speaker：\n- bgp 处理 bgpcong、bgppeer \n- 考虑与其他 bgp cni 兼容\n\t不部署 speaker? 添加 label openelb.kubesphere.io/cni: calico，但是还存在一定问题\n- 正常建立 bgp peer 并发布路由\n- gobgp policy\n\n3. vip speaker：\n- 分配 svcip 后填充 configmap\n- 将 svcip 注册到网卡\n- 故障转移\n\n#### enhance 功能：\n1. 多个 speaker 的启动配置\n- 是否启用\n- 是否允许多个 speaker 同时存在\n\n2. vip 卸载\n- vip 卸载 keepalived-vip ds 依旧存在\n\n#### feature 开发：\n1. layer2 模式：\n- 多网卡问题 -  通过 node lable 指定后 arping 不通\n- eip 过滤节点\n- layer2 宣告策略\n- 记录 node-svcip 的记录\n\n2. vip 模式：\n- 多网卡情况下绑定网卡\n- 绑定 vip-master 节点(待调研)\n- 配置多个 vrrp instance\n\n3. 支持 endpointslice - svc externalTrafficPolicy local/cluster\n\n#### 其余问题\nlayer2 模式的单点故障解决方案：\n- leaderelecator\n如果使用 leaderelecator 则对于一个 ip 相应有一个 lease，但是\n- memberlist\n获取 memberlist 的 watch 事件，之后进行处理\n\n\n### openelb-apiserver 功能点： \ndeployment - container\n\n### openelb-agent 功能点：\n*(考虑是否可以去掉)* - 复用speaker \n- 获取主机的网卡信息 -\u003e apiserver -\u003e console 显示选择网卡\n\n### openelb-console\n1. 没有设置默认 eip \n2. 对于填写网卡时的提示信息\n3. bgpconf - name\n4. ip 设置段时错误信息提示错误，填写完成时未消失\n5. 添加 respone msg + code \n6. console github issue、pr 模板\n7. http 请求日志\n8. 改一下图标\n\n### 额外的开发工作：\n- helm chart - helm 卸载 keepalived 仍然在\n- helm chart 迁移到主仓库\n- 测试 - deploy securityContext  cri-o runtime 启动不了的解决办法\n- 日志等级 + 日志格式\n- 是否支持多租户？\n\n### e2e测试 \nspeaker - test\n- ExternalTrafficPolicy - forward to loacl node\n- nexthop should change when endpoint changed\n- Nexthops should not be all nodes\n- 多个网卡\n- 升级方案 - helm","lastmodified":"2023-05-25T02:18:50.643442527Z","tags":null},"/%E7%8C%AB%E5%92%AA%E5%96%82%E5%85%BB-2022":{"title":"猫咪喂养-2022","content":"\n### 1. 食物\n1.  猫粮\n-   如果猫碗里面有剩余的猫粮，可以先将粮放到猫粮旁边的塑料盒中，方盒和圆盒都可以\n-   先洗一下不锈钢猫碗（底下使用了双面胶固定，洛洛有时会舔盘子，把盘子弄到地上）\n-   洗完之后使用马桶旁边的纸巾擦干\n-   使用'称' 并\"去皮\"后，倒入120g左右猫粮（可以加上之前剩下的），之后将碗放置到双面胶上固定\n2.  化毛膏 喂大约3-5cm\n3.  益生菌 称好粮之后，倒入一袋益生菌。\n\n### 2. 饮水\n1.  洛洛听到水龙头的水声，有时会冲过去，将水龙头摆向热水（靠外侧），先水开到最大，让水加热一会，等待水变温之后，将水调小一点之后给洛洛喝。如果洛洛自己喝，那就等待喝完之后关闭水龙头；如果洛洛没有自己喝，麻烦用手接一些水给洛洛喝\n2.  猫碗旁边的小碗和水杯中的水换成水龙头里面的温水\n\n### 3. 擦眼屎\n1.  眼部湿巾放置在猫粮边\n2.  先取一片，之后用湿巾将眼屎湿润之后再擦掉\n\n\n### 4. 铲猫砂\n1.  两天可能有一点点多，用小铲铲将球球铲到黑色的塑料盒中，铲大约3-4团倒入马桶，立马冲掉防止猫砂吸水变大堵马桶（一般情况3-4团不会堵马桶）\n2.  清理一下猫砂周边掉落的猫砂\n\n### 5. 喂养时间\n (2022-01) 31号、2号、4号。4号加的猫粮多一点点，大约140g左右\n\n\n如果时间允许的话可以多陪一下洛洛，用逗猫棒或者激光笔和洛洛玩一会、撸一会洛洛\n**注：**\n1.  **如果猫咪有什么异样（呕吐、猫粮剩余较多、拉稀等），请立即联系我。**\n2.  **猫咪相关的会放置在猫粮旁边，如果有什么找不到，请联系我**\n\n[猫咪喂养 (yuque.com)](https://yunkang.yuque.com/xxvgdy/lau42v/nlu3x1?)","lastmodified":"2023-05-25T02:18:50.643442527Z","tags":null},"/%E7%8C%AB%E5%92%AA%E5%96%82%E5%85%BB-2023":{"title":"猫咪喂养-2023","content":"\n\u003e note: \n\u003e - 猫咪生性调皮捣蛋，如果上门的时候发现一些杯子、盒子啥的东西掉到了地上，麻烦也帮收拾一下，多半是被猫咪碰到地上的\n\u003e - 猫咪经常会在阳台的吊床上休息，有时候往吊床上跳的时候会把毯子踢歪，也麻烦帮收拾一下洛洛的毯子\n\u003e -  有时间的话摸摸洛洛 (撸猫)\n\n### 1. 食物\n#### 猫粮\n- 吃饭的碗具在电脑桌的左下方，有一个不锈钢的小碟子和一个猫脸的圆盆(猫粮主要用那个不锈钢的碟子，圆盆用来放一些旧的粮或者怕猫不够吃的情况在盆里她多加一点)\n- 猫粮袋子在猫碗具的旁边\n- 喂粮前先把不锈钢的小碟洗一洗(有剩粮的话就先倒在盆里)，用卫生纸擦干，然后加上盆里的或者袋子里的猫粮，给差不多 2~3 天的粮。(不怕给多，给多了下次来的时候就知道差不多加多少粮就可以了)\n- 如果猫有软便或者拉稀的情况，在放鸡脖的抽屉里面找一找益生菌，一整袋均匀倒到猫粮里面\n\n#### 鸡脖\n在抽屉里面拿一个鸡脖，可以手拿着喂一下也可以用剪刀剪成大约一小节手指长度的块喂她，(洛洛不护食，可以手拿着喂，但是要注意她可能吃的时候会往下拽，你得抓紧点；而且如果剩下比较小的一截的话，要小心一点，洛洛可能会咬到你的手) (剪成一小节是因为洛洛喜欢吃鸡脖，吃的会比较急，她会一大块吃下去发现咽不下会吐出来再咬一咬)\n\n\n### 2. 饮水\n洛洛只喝新鲜的水，所以把标注水的地方都给换上新的水就可以（洗一洗杯子，接上水龙头里面的水，然后茶几上的水杯要都放在防滑垫上哦）（有一个塑料的小斗会比较软，小心拿取）\n（小米饮水机直接拿那个塑料的两边就可以拿起来）\n\n### 3. 擦眼屎\n- 擦眼屎的在电脑桌的架子上，在胶带的圈圈里面\n- 用一张擦眼屎湿巾，然后把洛洛四脚朝天放在自己腿上，控住头\n- 能扣的扣掉也可以，粘住毛的就用湿巾擦吧\n\n\n### 4. 铲猫砂\n- 铲铲在猫粮下面的空隙里\n- 铲的团团还是放在垃圾袋里扔掉吧，洛洛喜欢贴边尿，可能铲的时候不是很方便\n- 清理一下猫砂周边掉落的猫砂，扫把在外面的楼梯附近\n\n### 5. 猫玩具\n洛洛喜欢玩球球，每次上门给她从抽屉拿两个球球，丢在地上就可以\n\n### 6. 喂养时间\n (2023-01) 21号、23号、25号、27号\n\n### 7.  路线图\n![upgit_20230116_1673848497.png](https://gitee.com/rykren/images/raw/master/2023/01/upgit_20230116_1673848497.png)\n\n### 8. 位置图 \n剪刀在梳妆台上，如果没有找到的话，在灶台靠墙的刀具上也有一把剪刀。\n![upgit_20230118_1674019525.png](https://gitee.com/rykren/images/raw/master/2023/01/upgit_20230118_1674019525.png)\n","lastmodified":"2023-05-25T02:18:50.643442527Z","tags":null}}